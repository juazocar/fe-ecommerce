<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Tienda Online</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body class="d-flex flex-column min-vh-100">

  <!-- Header -->
  <header class="bg-primary text-white text-center py-3">
    <h1>Tienda de Productos</h1>
  </header>

  <!-- Contenido Principal -->
  <main class="container my-4 flex-grow-1">
    <div class="row">
      <!-- Productos -->
      <div class="col-md-8">
        <h4>Productos Disponibles</h4>
        <div id="productos" class="row g-3">
          <!-- Productos cargados desde API -->
        </div>
      </div>

      <!-- Carrito -->
      <div class="col-md-4">
        <h4>Carrito de Compras</h4>
        <ul id="carrito" class="list-group mb-3">
          <!-- Items del carrito -->
        </ul>
        <h5>Total: $<span id="total">0.00</span></h5>
        <button class="btn btn-success w-100" id="realizarCompra">Realizar Compra</button>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-dark text-white text-center py-3">
    <small>© 2025 Tienda Online - Ejemplo educativo</small>
  </footer>

  <!-- Script principal -->
  <script>
    const apiUrl = 'http://localhost:8080/product/products';
    const carrito = [];

    function cargarProductos() {
      $.get(apiUrl, function(data) {
        $('#productos').empty();
        data.forEach(p => {
          $('#productos').append(`
            <div class="col-md-6">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">${p.name}</h5>
                  <p class="card-text">${p.description}</p>
                  <p class="card-text"><strong>$${p.price}</strong></p>
                  <button class="btn btn-primary w-100" onclick="agregarAlCarrito(${p.id}, '${p.name}', ${p.price})">Agregar al carrito</button>
                </div>
              </div>
            </div>
          `);
        });
      });
    }

    function agregarAlCarrito(id, nombre, precio) {
      carrito.push({ id, nombre, precio });
      actualizarCarrito();
    }

    function actualizarCarrito() {
      const lista = $('#carrito');
      lista.empty();
      let total = 0;
      carrito.forEach((item, index) => {
        total += item.precio;
        lista.append(`
          <li class="list-group-item d-flex justify-content-between align-items-center">
            ${item.nombre} - $${item.precio.toFixed(2)}
            <button class="btn btn-sm btn-danger" onclick="eliminarDelCarrito(${index})">X</button>
          </li>
        `);
      });
      $('#total').text(total.toFixed(2));
    }

    function eliminarDelCarrito(index) {
      carrito.splice(index, 1);
      actualizarCarrito();
    }

    $('#realizarCompra').click(function() {
      if (carrito.length === 0) {
        alert('Tu carrito está vacío.');
        return;
      }

      // Aquí puedes hacer un POST al backend con los productos
      const resumen = carrito.map(p => `• ${p.nombre} - $${p.precio.toFixed(2)}`).join('\n');
      alert('¡Compra realizada con éxito! \n\nResumen:\n' + resumen);

      carrito.length = 0;
      actualizarCarrito();
    });

    $(document).ready(function() {
      cargarProductos();
    });
  </script>

</body>
</html>
